{% load static %}
<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–∞—à–±–æ—Ä–¥ –∞–Ω–∞–ª—ñ—Ç–∏–∫–∏ - Silpo Monitor</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link rel="stylesheet" href="{% static 'monitoring/css/dashboard.css' %}">
    
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">
                <i class="fas fa-chart-line"></i> Silpo Monitor
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'home' %}">
                            <i class="fas fa-home"></i> –ì–æ–ª–æ–≤–Ω–∞
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="{% url 'dashboard_v1' %}">
                            <i class="fas fa-tachometer-alt"></i> –î–∞—à–±–æ—Ä–¥
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/admin/">
                            <i class="fas fa-cog"></i> –ê–¥–º—ñ–Ω
                        </a>
                    </li>
                    <li class="nav-item">
                        <span class="nav-link">
                            <i class="fas fa-user"></i> {{ user.username }}
                        </span>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <div class="row mb-4">
            <div class="col-md-4">
                <div class="stats-card">
                    <div class="stats-icon bg-primary">
                        <i class="fas fa-store"></i>
                    </div>
                    <div class="stats-content">
                        <h3>{{ stats.total_stores }}</h3>
                        <p>–ú–∞–≥–∞–∑–∏–Ω—ñ–≤</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stats-card">
                    <div class="stats-icon bg-success">
                        <i class="fas fa-box"></i>
                    </div>
                    <div class="stats-content">
                        <h3>{{ stats.total_product_types }}</h3>
                        <p>–¢–∏–ø—ñ–≤ –ø—Ä–æ–¥—É–∫—Ç—ñ–≤</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stats-card">
                    <div class="stats-icon bg-info">
                        <i class="fas fa-shopping-cart"></i>
                    </div>
                    <div class="stats-content">
                        <h3>{{ stats.total_products|floatformat:0 }}</h3>
                        <p>–¢–æ–≤–∞—Ä—ñ–≤</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-6 mb-4">
                <div class="card chart-card">
                    <div class="card-header">
                        <h5><i class="fas fa-chart-bar"></i> –°–µ—Ä–µ–¥–Ω—ñ —Ü—ñ–Ω–∏ –∑–∞ —Ç–∏–ø–∞–º–∏ –ø—Ä–æ–¥—É–∫—Ç—É</h5>
                    </div>
                    <div class="card-body">
                        {{ chart1|safe }}
                    </div>
                </div>
            </div>

            <div class="col-lg-6 mb-4">
                <div class="card chart-card">
                    <div class="card-header">
                        <h5><i class="fas fa-chart-area"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–∞–≥–∞–∑–∏–Ω—ñ–≤ –∑–∞ –º—ñ—Å—Ç–∞–º–∏</h5>
                    </div>
                    <div class="card-body">
                        {{ chart2|safe }}
                    </div>
                </div>
            </div>

            <div class="col-lg-6 mb-4">
                <div class="card chart-card">
                    <div class="card-header">
                        <h5><i class="fas fa-medal"></i> –¢–æ–ø-10 –Ω–∞–π–¥–æ—Ä–æ–∂—á–∏—Ö –ø—Ä–æ–¥—É–∫—Ç—ñ–≤</h5>
                    </div>
                    <div class="card-body">
                        {{ chart3|safe }}
                    </div>
                </div>
            </div>

            <div class="col-lg-6 mb-4">
                <div class="card chart-card">
                    <div class="card-header">
                        <h5><i class="fas fa-chart-pie"></i> –†–æ–∑–ø–æ–¥—ñ–ª —Ç–æ–≤–∞—Ä—ñ–≤ –∑–∞ —Ü—ñ–Ω–æ–≤–∏–º–∏ –¥—ñ–∞–ø–∞–∑–æ–Ω–∞–º–∏</h5>
                    </div>
                    <div class="card-body">
                        {{ chart4|safe }}
                    </div>
                </div>
            </div>

            <div class="col-lg-6 mb-4">
                <div class="card chart-card">
                    <div class="card-header">
                        <h5><i class="fas fa-tags"></i> –ê–Ω–∞–ª—ñ–∑ –ø—Ä–æ–º–æ-–∞–∫—Ü—ñ–π</h5>
                    </div>
                    <div class="card-body">
                        {{ chart5|safe }}
                    </div>
                </div>
            </div>

            <div class="col-lg-6 mb-4">
                <div class="card chart-card">
                    <div class="card-header">
                        <h5 class="card-title">üîÑ –ü—Ä–æ–º–æ vs –†–µ–≥—É–ª—è—Ä–Ω—ñ —Ç–æ–≤–∞—Ä–∏</h5>
                    </div>
                    <div class="card-body">
                        {{ chart6|safe }}
                    </div>
                </div>
            </div>
        </div>

        <!-- –¢–∞–±–ª–∏—Ü—è –ø—Ä–æ–¥—É–∫—Ç—ñ–≤ –∑ –ø–∞–≥—ñ–Ω–∞—Ü—ñ—î—é -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-light">
                        <h5 class="mb-0">
                            <i class="fas fa-list"></i> –°–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ç—ñ–≤
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>–ù–∞–∑–≤–∞</th>
                                        <th>–¢–∏–ø</th>
                                        <th>–ú–∞–≥–∞–∑–∏–Ω</th>
                                        <th>–ú—ñ—Å—Ç–æ</th>
                                        <th>–¶—ñ–Ω–∞</th>
                                        <th>–ü—Ä–æ–º–æ</th>
                                        <th>–î–∞—Ç–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for product in page_obj %}
                                    <tr>
                                        <td><strong>{{ product.name }}</strong></td>
                                        <td><span class="badge bg-primary">{{ product.product_type.name }}</span></td>
                                        <td>{{ product.store.name }}</td>
                                        <td>{{ product.store.city }}</td>
                                        <td>
                                            {% if product.promo_price %}
                                                <span class="text-decoration-line-through text-muted">{{ product.regular_price }} –≥—Ä–Ω</span>
                                                <span class="text-danger fw-bold">{{ product.promo_price }} –≥—Ä–Ω</span>
                                            {% else %}
                                                <span class="fw-bold">{{ product.regular_price }} –≥—Ä–Ω</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if product.promo_price %}
                                                <span class="badge bg-success">
                                                    <i class="fas fa-tag"></i> –ê–∫—Ü—ñ—è
                                                </span>
                                            {% else %}
                                                <span class="badge bg-secondary">
                                                    <i class="fas fa-minus"></i> –ù–µ–º–∞—î
                                                </span>
                                            {% endif %}
                                        </td>
                                        <td>{{ product.created_at|date:"d.m.Y H:i" }}</td>
                                    </tr>
                                    {% empty %}
                                    <tr>
                                        <td colspan="7" class="text-center text-muted">
                                            <i class="fas fa-inbox"></i> –ü—Ä–æ–¥—É–∫—Ç—ñ–≤ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>

                        <!-- –ü–∞–≥—ñ–Ω–∞—Ü—ñ—è -->
                        {% if page_obj.has_other_pages %}
                        <nav aria-label="–ü–∞–≥—ñ–Ω–∞—Ü—ñ—è –ø—Ä–æ–¥—É–∫—Ç—ñ–≤" class="mt-4">
                            <ul class="pagination justify-content-center">
                                {% if page_obj.has_previous %}
                                    <li class="page-item">
                                        <a class="page-link" href="?page=1" aria-label="–ü–µ—Ä—à–∞">
                                            <span aria-hidden="true">&laquo;&laquo;</span>
                                        </a>
                                    </li>
                                    <li class="page-item">
                                        <a class="page-link" href="?page={{ page_obj.previous_page_number }}" aria-label="–ü–æ–ø–µ—Ä–µ–¥–Ω—è">
                                            <span aria-hidden="true">&laquo;</span>
                                        </a>
                                    </li>
                                {% else %}
                                    <li class="page-item disabled">
                                        <span class="page-link">&laquo;&laquo;</span>
                                    </li>
                                    <li class="page-item disabled">
                                        <span class="page-link">&laquo;</span>
                                    </li>
                                {% endif %}

                                {% for num in page_obj.paginator.page_range %}
                                    {% if page_obj.number == num %}
                                        <li class="page-item active" aria-current="page">
                                            <span class="page-link">{{ num }}</span>
                                        </li>
                                    {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                                        <li class="page-item">
                                            <a class="page-link" href="?page={{ num }}">{{ num }}</a>
                                        </li>
                                    {% endif %}
                                {% endfor %}

                                {% if page_obj.has_next %}
                                    <li class="page-item">
                                        <a class="page-link" href="?page={{ page_obj.next_page_number }}" aria-label="–ù–∞—Å—Ç—É–ø–Ω–∞">
                                            <span aria-hidden="true">&raquo;</span>
                                        </a>
                                    </li>
                                    <li class="page-item">
                                        <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}" aria-label="–û—Å—Ç–∞–Ω–Ω—è">
                                            <span aria-hidden="true">&raquo;&raquo;</span>
                                        </a>
                                    </li>
                                {% else %}
                                    <li class="page-item disabled">
                                        <span class="page-link">&raquo;</span>
                                    </li>
                                    <li class="page-item disabled">
                                        <span class="page-link">&raquo;&raquo;</span>
                                    </li>
                                {% endif %}
                            </ul>
                            <p class="text-center text-muted">
                                –°—Ç–æ—Ä—ñ–Ω–∫–∞ {{ page_obj.number }} –∑ {{ page_obj.paginator.num_pages }} 
                                (–≤—Å—å–æ–≥–æ {{ page_obj.paginator.count }} –ø—Ä–æ–¥—É–∫—Ç—ñ–≤)
                            </p>
                        </nav>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-light text-center py-3 mt-5">
        <div class="container">
            <p class="mb-0 text-muted">
                <i class="fas fa-copyright"></i> 2025 Silpo Monitor Dashboard | 
                –†–æ–∑—Ä–æ–±–ª–µ–Ω–æ –∑ <i class="fas fa-heart text-danger"></i>
            </p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script src="{% static 'monitoring/js/dashboard_plotly.js' %}"></script>
</body>
</html>
